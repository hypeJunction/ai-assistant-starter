---
applyTo: "**/*"
priority: critical
role: [developer, tester, reviewer, architect]
---

# Global AI Assistant Instructions

> **Priority:** Critical - These rules apply to ALL files and ALL roles.
> **Context Files:** [INDEX.md](./INDEX.md) | [.memory.md](./.memory.md) | [.context.md](./.context.md)

## Execution Protocol

### Following Instructions

When task instructions reference specific commands, procedures, or documentation:

1. **Read completely** - Review the entire referenced instruction file before starting
2. **Follow exactly** - Execute documented steps precisely as written, in the specified order
3. **Ask when unclear** - Request clarification before proceeding if steps are ambiguous
4. **Document deviations** - Only deviate from instructions when explicitly approved by user
5. **Verify completion** - Confirm all steps completed successfully before marking task done

**Default Behavior:** Execute documented procedures without modification or improvisation.

### Instruction Hierarchy

When instructions conflict, follow this priority order:

1. **User's explicit request** (highest priority)
2. **Global instructions** (this file)
3. **Domain-specific instructions** (e.g., `typescript.instructions.md`)
4. **Workflow-specific instructions** (e.g., `refactor.prompt.md`)
5. **General best practices** (lowest priority)

## Documentation Policy

### File Creation Guidelines

**Create freely to support development:**

- Configuration files (tsconfig, vite.config, etc.)
- `*.stories.ts` files (Storybook stories)
- `*.spec.ts` or `*.test.ts` files (tests)
- Source code files (`.ts`, `.tsx`, `.js`, `.jsx`, `.vue`)
- Entries in `.ai-assistant/todos/`
- File lists in `.ai-assistant/file-lists/`

**Require explicit user approval before creating:**

- README.md or README files
- Documentation files outside `.ai-assistant/`
- API documentation (Swagger, OpenAPI, JSDoc files)
- Architecture diagrams or design documents
- CHANGELOG.md or release notes
- Generic "how-to" guides

**Rationale:** Code should be self-documenting. External documentation often becomes stale and misleading.

## Communication Style

### Response Format

- **Concise** - Keep responses short and to the point
- **No summaries** - Don't summarize work after completion unless asked
- **No explanations** - Let code speak for itself unless user requests explanation
- **Action-focused** - Show what you're doing through tool use, not narration
- **Friendly but professional** - Informal tone, but maintain technical accuracy

### Course Correction

When working on a task, use these techniques to adjust direction:

- **Interrupt** - Stop current operation to preserve context and change direction
- **Request undo** - Ask to backtrack on an approach that isn't working
- **Ask for plan** - Request detailed planning before complex implementations
- **Clear context** - Reset between unrelated tasks to improve focus

**When to course correct:**
- Output is going in wrong direction
- Better approach becomes apparent mid-task
- Context is getting cluttered with irrelevant information
- Need to explore alternative solutions

### Callout Syntax for User Attention

Use these callout blocks to draw user attention to important information:

**Action Required** - User must do something or make a decision:
```markdown
> **ACTION REQUIRED:**
> Describe what the user needs to do or decide.
> - Option A: description
> - Option B: description
```

**Warning** - Important caution or risk the user should be aware of:
```markdown
> **WARNING:**
> Describe the risk or important caution.
```

**Info** - Helpful context or explanation (use sparingly):
```markdown
> **INFO:**
> Additional context that may be useful.
```

**When to use callouts:**
- User needs to make a decision between options
- User needs to provide input (file path, name, choice)
- Destructive or risky operation requires confirmation
- Scope exceeds thresholds and needs approval
- Discrepancy found that needs user resolution

**When NOT to use callouts:**
- Standard progress updates
- Routine confirmations
- Information that doesn't require user action

### Token Optimization

To preserve context window space:

1. **Search before reading** - Use `grep` to find relevant files before reading
2. **Read selectively** - Only read files you need to modify
3. **Avoid re-reading** - Don't re-read files already in conversation context
4. **Plan before executing** - Think through approach before taking action
5. **Use domain instructions** - Reference domain files instead of duplicating content

## Task Management

### Todo Tracking

**Use task tracking for:**

- Complex tasks with 3+ distinct steps
- Non-trivial tasks requiring careful planning
- User provides multiple tasks (numbered or comma-separated list)
- User explicitly requests todo list

**Skip task tracking for simple cases:**

- Single straightforward task
- Trivial task completable in <3 steps
- Purely conversational/informational requests

**Task Management Rules:**

1. Mark task `in_progress` BEFORE starting work (exactly ONE at a time)
2. Mark task `completed` IMMEDIATELY after finishing
3. Update task status in real-time as work progresses
4. Don't batch completions - mark each task complete as it finishes
5. Remove irrelevant tasks from the list entirely

**Task Descriptions:**

- **content:** Imperative form ("Run tests", "Build project")
- **activeForm:** Present continuous form ("Running tests", "Building project")

### Long-Term Todo Tracking

**IMPORTANT:** Track all shortcuts, compromises, and deferred improvements.

When taking shortcuts or identifying future work:

1. Add entry to `.ai-assistant/todos/` following the template
2. Include affected files/components
3. Explain context and proper solution
4. See [workflows/create-todo.prompt.md](./workflows/create-todo.prompt.md)

### File List Tracking

**IMPORTANT:** Document file batches for large-scale work.

When finding multiple files needing similar changes (>5 files):

1. Create file list in `.ai-assistant/file-lists/[descriptive-name].md`
2. Document search criteria and commands used
3. Track progress with checkboxes
4. See [workflows/create-file-list.prompt.md](./workflows/create-file-list.prompt.md)

### History Entries

**IMPORTANT:** Preserve knowledge from significant work.

Create a history entry in `.ai-assistant/history/` after completing:

- Refactors affecting 5+ files
- Architectural changes or pattern migrations
- Bug fixes with non-obvious solutions
- Feature implementations with design decisions

**Entry contents:**
1. Summary of what was accomplished
2. Context and motivation
3. Key decisions and reasoning
4. Before/after patterns
5. Lessons learned

**Naming:** `{type}-{descriptive-name}.md` (e.g., `refactor-api-client.md`)

See [history/README.md](./history/README.md) for template and guidelines.

## Scope Management

### Large-Scale Change Policy

**CRITICAL:** Avoid large-scale changes from direct user requests. Redirect to the refactor workflow.

**Scope Thresholds:**

| Scope | Files | Action |
|-------|-------|--------|
| Small | 1-5 files | Proceed directly |
| Medium | 6-20 files | Confirm with user, consider refactor workflow |
| Large | 21+ files | **MUST use [refactor workflow](./workflows/refactor.prompt.md)** |

**When to Invoke Refactor Workflow:**

- User requests rename/replace across multiple files
- Pattern changes affecting many components
- API migrations or library upgrades
- Bulk code modifications
- Any request that would touch 6+ files

**How to Redirect:**

```markdown
> **WARNING:**
> This request would affect [N] files, which qualifies as a [medium/large]-scale change.

> **ACTION REQUIRED:**
> For changes of this scope, I recommend using the refactor workflow (`/refactor`) which provides:
> - Proper planning and scope analysis
> - Pattern detection for edge cases
> - Parallel execution with progress tracking
> - Validation checkpoints
>
> **Proceed with refactor workflow?** (yes/no)
```

**Why This Matters:**

- Large-scale changes without planning lead to inconsistencies
- Edge cases get missed without pattern analysis
- Progress is hard to track across many files
- Validation becomes difficult without checkpoints

## Code Quality Standards

### General Principles

1. **Prefer editing to creating** - Always edit existing files over creating new ones
2. **Follow existing patterns** - Match the style and structure of surrounding code
3. **No premature optimization** - Write clear code first, optimize only when needed
4. **Test as you go** - Run tests for changed components only (never full test suite)
5. **Security awareness** - Avoid XSS, SQL injection, command injection, and OWASP Top 10 vulnerabilities
6. **Scope awareness** - Recognize when requests require large-scale changes and redirect appropriately

### Code Style

- Follow project linter/formatter configuration
- Let tooling handle formatting (don't format manually)

### Comments Policy

**General Rule:** Write comments that explain complex behaviors, not obvious code.

**Write comments for:**
- Non-obvious behavior explanations
- Complex algorithm explanations
- Workaround justifications with ticket references
  - Example: `// WORKAROUND: See TICKET-123 for context`

**Avoid comments for:**
- Comments that repeat function/variable/method names
  - Poor: `// Gets user name` above `getUserName()`

### Logging

- Use project's logger for debug messages
- Never use `console.log` in production code
- Log levels: `debug`, `info`, `warn`, `error`
- Don't log user-facing text (use for debugging only)

## Testing Requirements

### Test Execution Policy

**CRITICAL:** Always scope tests to changed components only.

**Run focused tests:**
```bash
# Examples - adapt to your project's test commands
npm run test -- ComponentName
npm run test:unit -- pattern
npx vitest run file.spec
```

**Avoid full test suite commands unless explicitly requested.**

### Test Plan Requirements

**CRITICAL:** All test files MUST include a test plan as a comment at the top.

**Required for:**
- All `*.spec.ts` unit test files
- All `*.stories.ts` Storybook story files
- All `*.test.ts` integration test files

**Format:** Gherkin syntax (Given-When-Then)

```typescript
/**
 * Test Plan: ComponentName
 *
 * Scenario: Brief description
 *   Given [initial state/context]
 *   When [action or trigger]
 *   Then [expected outcome]
 *   And [additional expectations]
 */
```

See [domains/testing.instructions.md](./domains/testing.instructions.md) for examples.

## Domain-Specific Guidelines

For detailed rules about specific technologies and patterns, see:

- **[TypeScript Rules](./domains/typescript.instructions.md)** - Type usage, imports, exports
- **[Testing Practices](./domains/testing.instructions.md)** - Test patterns, mocking

Add more domain files as your project needs them:
- Vue/React/Angular component patterns
- CSS/styling guidelines
- i18n/translation requirements
- Accessibility standards

## Workflow Guidelines

For step-by-step task instructions, see:

- **[Validate](./workflows/validate.prompt.md)** - Run validation checks
- **[Refactor](./workflows/refactor.prompt.md)** - Systematic codebase refactoring
- **[Create Todo](./workflows/create-todo.prompt.md)** - Document deferred improvements
- **[Create File List](./workflows/create-file-list.prompt.md)** - Track batches of files needing work

## Context Preservation

### Session Memory

**Project Context:** Preserved in [.memory.md](./.memory.md)
- Architecture and tech stack
- Key patterns and conventions
- Known issues and limitations
- Recent work areas

**Quick Reference:** Available in [.context.md](./.context.md)
- Common import patterns
- Frequently used commands
- File locations
- Quick lookup tables

### Updating Context

As you work on the project, update `.memory.md` when:
- Major architectural changes occur
- New patterns are established
- Important decisions are made
- Project structure changes

## Role-Based Behavior

This project uses chatmode configurations for role-based workflows:

- **[Developer Mode](./chatmodes/developer.chatmode.md)** - Code implementation and modification
- **[Tester Mode](./chatmodes/tester.chatmode.md)** - Testing and quality assurance
- **[Reviewer Mode](./chatmodes/reviewer.chatmode.md)** - Code review and suggestions
- **[Architect Mode](./chatmodes/architect.chatmode.md)** - Design and planning

See individual chatmode files for role-specific restrictions and capabilities.

---

**Last Updated:** {{DATE}}
**Version:** 1.0
